<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ngomani's Scientific Calculator</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Enable horizontal scrolling on the screen container */
        .screen {
            overflow-x: auto;
        }
        /* Make the calculator screen's input wide and nowrap */
        #calc-screen {
            width: 100%;
            white-space: nowrap;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="calculator">
        <!-- Screen -->
        <div class="screen">
            <input type="text" id="calc-screen" readonly value="0">
        </div>
        <!-- Keys Container -->
        <div class="keys">
            <!-- Top Keys Row -->
            <div class="row top-keys">
                <button id="second-toggle" class="shift">2ndF</button>
                <button class="alpha">ALPHA</button>
                <button>MCL</button>
                <button>RCL</button>
                <button class="red">Del</button>
                <button class="red">AC</button>
            </div>
            <!-- Function Keys Row -->
            <div class="row function-keys">
                <button>hyp</button>
                <button class="dual" data-primary="sin" data-secondary="sin⁻¹">sin</button>
                <button class="dual" data-primary="cos" data-secondary="cos⁻¹">cos</button>
                <button class="dual" data-primary="tan" data-secondary="tan⁻¹">tan</button>
                <button>x²</button>
                <button>x³</button>
                <button class="dual" data-primary="√" data-secondary="∛">√</button>
                <button class="dual" data-primary="log" data-secondary="ln">log</button>
                <button class="dual" data-primary="10^x" data-secondary="e^x">10^x</button>
                <button class="dual" data-primary="1/x" data-secondary="Ran#">1/x</button>
            </div>
            <!-- Bottom Keys Row (Numpad & Operators) -->
            <div class="row bottom-keys">
                <table>
                    <tr>
                        <td><button>7</button></td>
                        <td><button>8</button></td>
                        <td><button>9</button></td>
                        <td><button class="operator">+</button></td>
                        <td><button class="operator">-</button></td>
                    </tr>
                    <tr>
                        <td><button>4</button></td>
                        <td><button>5</button></td>
                        <td><button>6</button></td>
                        <td><button class="operator">×</button></td>
                        <td><button class="operator">÷</button></td>
                    </tr>
                    <tr>
                        <td><button>1</button></td>
                        <td><button>2</button></td>
                        <td><button>3</button></td>
                        <td><button class="operator">(</button></td>
                        <td><button class="operator">)</button></td>
                    </tr>
                    <tr>
                        <td><button>0</button></td>
                        <td><button>00</button></td>
                        <td><button id="dot-btn">.</button></td>
                        <td><button id="ans-btn">ANS</button></td>
                        <td><button id="xpowery-btn">x^y</button></td>
                    </tr>
                </table>
            </div>
            <!-- Equals Row -->
            <div class="row equals-row">
                <button class="equal wide">=</button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for handling input, evaluation, scrolling, and 2ndF toggling -->
<script>
    // Global variable to store the last computed answer.
    let lastAns = "";
    let isSecondFunction = false; // flag for dual button toggle
    let evaluated = false; // flag to indicate if the last action was an evaluation

    // Function to update horizontal scroll of the screen.
    function updateScroll() {
        const screenElem = document.getElementById('calc-screen');
        screenElem.scrollLeft = screenElem.scrollWidth;
    }

    // Toggle 2nd function on dual keys when 2ndF is pressed.
    document.getElementById("second-toggle").addEventListener("click", function(e){
        isSecondFunction = !isSecondFunction;
        document.querySelectorAll(".dual").forEach(function(btn) {
            btn.innerText = isSecondFunction ? btn.getAttribute("data-secondary") : btn.getAttribute("data-primary");
        });
        // Prevent the "2ndF" button from adding its text to the screen.
        e.stopPropagation();
    });

    // Add event listeners to all buttons (except the equal button and the 2ndF toggle).
    document.querySelectorAll('.keys button:not(.equal)').forEach(function(button) {
        button.addEventListener('click', function(e) {
            // If this is the 2ndF button, do nothing further.
            if(this.id === "second-toggle") {
                return;
            }
            const btnText = this.innerText;
            const screen = document.getElementById('calc-screen');

            // If last action was an evaluation and a number (or dot) is pressed, clear the screen.
            if(evaluated && /^[0-9.]$/.test(btnText)) {
                screen.value = "";
                evaluated = false;
            } else {
                evaluated = false;
            }

            if (btnText === "AC") {
                screen.value = "0";
            } else if (btnText === "Del") {
                // Remove the last character.
                if(screen.value.length > 0) {
                    screen.value = screen.value.slice(0, -1);
                }
                if(screen.value === "") screen.value = "0";
            } else if (btnText === "ANS") {
                if(lastAns !== "") {
                    let formattedAns = String(lastAns).replace(/^0+/, '');
                    if(formattedAns === "") {
                        formattedAns = "0";
                    }
                    if(screen.value === formattedAns) {
                        screen.value = "0";
                    } else {
                        screen.value = formattedAns;
                    }
                }
            } else if (btnText === "x²") {
                // Find the last number in the screen and append the superscript ² to it.
                let current = screen.value;
                let regex = /(\d+(\.\d+)?)(?!.*\d)/;
                let match = current.match(regex);
                if(match) {
                    let numberStr = match[0];
                    screen.value = current.slice(0, match.index) + numberStr + "²";
                }
            } else if (btnText === "x³") {
                // Find the last number in the screen and append the superscript ³ to it.
                let current = screen.value;
                let regex = /(\d+(\.\d+)?)(?!.*\d)/;
                let match = current.match(regex);
                if(match) {
                    let numberStr = match[0];
                    screen.value = current.slice(0, match.index) + numberStr + "³";
                }
            } else {
                // Replace "0" with an empty string before appending new input.
                if(screen.value === "0") {
                    screen.value = "";
                }
                screen.value += btnText;
            }
            updateScroll();
        });
    });

    // Evaluate the expression when the equal button is clicked.
    document.querySelector('.equal').addEventListener('click', function() {
        const screen = document.getElementById('calc-screen');
        let expression = screen.value;

        // Replace calculator symbols with valid JavaScript operators.
        expression = expression.replace(/×/g, '*')
            .replace(/÷/g, '/')
            .replace(/x\^y/g, '**')
            .replace(/²/g, "**2")
            .replace(/³/g, "**3");

        try {
            const result = eval(expression);
            // Check for invalid results (e.g., division by zero).
            if (!isFinite(result)) {
                screen.value = "Error";
                lastAns = "";
            } else {
                screen.value = result;
                lastAns = result;
            }
        } catch(e) {
            screen.value = "Error";
            lastAns = "";
        }
        evaluated = true; // mark that evaluation just occurred
        updateScroll();
    });
</script>
</body>
</html>
